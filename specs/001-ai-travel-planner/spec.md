# Feature Specification: AI TravelTailor - 개인 맞춤형 여행 설계 서비스

**Feature Branch**: `001-ai-travel-planner`
**Created**: 2025-10-19
**Status**: Draft
**Input**: User description: "AI TravelTailor - 개인 맞춤형 여행 설계 서비스"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - AI 여행 일정 자동 생성 (Priority: P1)

여행자가 여행 조건(목적지, 기간, 예산, 동행자 유형, 선호사항)을 입력하면 AI가 최적화된 전체 여행 일정을 자동으로 생성합니다. 생성된 일정에는 숙소, 관광지, 식당, 이동 경로가 시간대별로 포함됩니다.

**Why this priority**: 이것이 서비스의 핵심 가치 제안입니다. 사용자는 복잡한 여행 계획을 직접 수립하는 대신 AI가 자동으로 최적화된 일정을 받아볼 수 있습니다.

**Independent Test**: 사용자가 "3박 4일, 도쿄, 예산 80만 원, 커플 여행, 맛집 중심"을 입력하고 완전한 여행 일정을 받아보는 것으로 독립적으로 테스트 가능합니다.

**Acceptance Scenarios**:

1. **Given** 사용자가 여행 입력 화면에 접속했을 때, **When** 목적지, 기간(3박 4일), 예산(80만원), 동행자 유형(커플), 선호사항(맛집)을 입력하고 생성 버튼을 클릭하면, **Then** 시스템은 30초 이내에 날짜별/시간대별로 구성된 여행 일정을 표시합니다.

2. **Given** AI가 여행 일정을 생성했을 때, **When** 사용자가 생성된 일정을 확인하면, **Then** 각 일자별로 숙소, 관광지(최소 2-3곳), 식당(아침/점심/저녁), 이동 경로가 포함되어 있습니다.

3. **Given** 사용자가 "가족 여행, 조용한 숙소 선호"를 입력했을 때, **When** AI가 일정을 생성하면, **Then** 추천 숙소와 관광지가 가족 친화적이고 혼잡하지 않은 장소로 구성됩니다.

4. **Given** 사용자가 예산 제약을 입력했을 때, **When** AI가 일정을 생성하면, **Then** 숙박, 식사, 관광의 총 예상 비용이 입력된 예산 범위 내에 있습니다.

---

### User Story 2 - 지도 기반 경로 시각화 및 내보내기 (Priority: P2)

생성된 여행 일정을 지도 위에 시각적으로 표시하고, 각 장소 간의 이동 경로와 예상 소요 시간을 확인할 수 있습니다. 사용자는 이 경로를 외부 지도 서비스(카카오맵, 구글맵)로 내보낼 수 있습니다.

**Why this priority**: 여행 일정의 실용성을 크게 높입니다. 사용자는 실제 여행 중 손쉽게 경로를 따라갈 수 있습니다.

**Independent Test**: 생성된 여행 일정에서 "지도 보기"를 클릭하여 모든 장소와 경로를 시각적으로 확인하고, "카카오맵으로 내보내기" 버튼으로 외부 앱에 경로를 전송하는 것으로 테스트 가능합니다.

**Acceptance Scenarios**:

1. **Given** 여행 일정이 생성되었을 때, **When** 사용자가 "지도 보기" 버튼을 클릭하면, **Then** 지도 위에 모든 방문 장소가 마커로 표시되고 이동 경로가 선으로 연결됩니다.

2. **Given** 지도에 경로가 표시되었을 때, **When** 사용자가 특정 장소 마커를 클릭하면, **Then** 해당 장소의 상세 정보(명칭, 방문 예정 시간, 예상 체류 시간)가 팝업으로 표시됩니다.

3. **Given** 사용자가 지도를 확인 중일 때, **When** "카카오맵으로 내보내기" 또는 "구글맵으로 내보내기" 버튼을 클릭하면, **Then** 해당 지도 서비스가 열리며 동일한 경로가 로드됩니다.

4. **Given** 지도에 이동 경로가 표시되었을 때, **When** 사용자가 두 장소 사이의 경로를 확인하면, **Then** 예상 이동 시간과 거리가 표시됩니다.

---

### User Story 3 - 여행 일정표 PDF 생성 및 다운로드 (Priority: P2)

사용자는 생성된 여행 일정을 브랜딩된 PDF 문서로 다운로드하여 오프라인에서도 확인하거나 인쇄할 수 있습니다.

**Why this priority**: 오프라인 접근성과 공유 편의성을 제공합니다. 여행 중 인터넷 연결이 불안정한 상황에서도 일정을 확인할 수 있습니다.

**Independent Test**: 여행 일정 화면에서 "PDF 다운로드" 버튼을 클릭하여 포맷된 PDF 파일을 받아보는 것으로 테스트 가능합니다.

**Acceptance Scenarios**:

1. **Given** 여행 일정이 생성되었을 때, **When** 사용자가 "PDF 다운로드" 버튼을 클릭하면, **Then** 10초 이내에 여행 일정이 포함된 PDF 파일이 다운로드됩니다.

2. **Given** PDF 파일이 다운로드되었을 때, **When** 사용자가 파일을 열면, **Then** 날짜별 일정, 장소 정보, 지도, 예산 요약이 깔끔하게 포맷되어 표시됩니다.

3. **Given** PDF가 생성될 때, **When** 사용자가 문서를 확인하면, **Then** TravelTailor 브랜드 로고와 스타일이 일관되게 적용되어 있습니다.

---

### User Story 4 - 항공편 및 숙박 예약 링크 제공 (Priority: P3)

생성된 여행 일정에 추천 항공편과 숙박 시설의 예약 링크가 포함되어 있어, 사용자가 직접 검색하지 않고도 바로 예약할 수 있습니다.

**Why this priority**: 사용자 편의성을 높이고, 제휴 수익 창출의 기반을 마련합니다.

**Independent Test**: 생성된 여행 일정에서 항공편/숙박 예약 링크를 클릭하여 외부 예약 사이트로 이동하는 것으로 테스트 가능합니다.

**Acceptance Scenarios**:

1. **Given** 여행 일정이 생성되었을 때, **When** 사용자가 일정을 확인하면, **Then** 추천 항공편 옵션(최소 2-3개)과 각각의 예약 링크가 표시됩니다.

2. **Given** 여행 일정에 숙박 정보가 포함되었을 때, **When** 사용자가 숙소 섹션을 확인하면, **Then** 추천 숙소와 예약 가능한 링크가 제공됩니다.

3. **Given** 사용자가 항공편 예약 링크를 클릭했을 때, **When** 링크가 열리면, **Then** 해당 항공편의 예약 페이지가 새 탭에서 열립니다.

---

### User Story 5 - 사용자 맞춤 학습 및 히스토리 관리 (Priority: P3)

사용자의 과거 여행 기록과 선호도를 저장하여, 다음 여행 계획 시 자동으로 취향을 반영한 추천을 제공합니다.

**Why this priority**: 재사용성과 개인화를 통해 사용자 경험을 향상시킵니다. 충성도 높은 사용자 기반을 구축할 수 있습니다.

**Independent Test**: 사용자가 두 번째 여행 일정을 생성할 때, 이전 여행에서의 선호도(예: 맛집 중심, 조용한 숙소)가 자동으로 반영되는지 확인하는 것으로 테스트 가능합니다.

**Acceptance Scenarios**:

1. **Given** 사용자가 이전에 여행 일정을 생성한 적이 있을 때, **When** 새로운 여행 일정 생성 화면에 접속하면, **Then** 이전 선호사항(예산 범위, 동행자 유형, 관심사)이 자동으로 입력 필드에 미리 채워져 있습니다.

2. **Given** 사용자가 로그인했을 때, **When** "여행 히스토리" 페이지에 접속하면, **Then** 과거에 생성한 모든 여행 일정이 목록으로 표시됩니다.

3. **Given** 사용자가 여행 히스토리를 확인할 때, **When** 특정 과거 여행을 선택하면, **Then** 해당 여행의 전체 일정과 PDF를 다시 확인하거나 다운로드할 수 있습니다.

---

### Edge Cases

- **입력 데이터 불완전**: 사용자가 필수 정보(목적지, 날짜)를 입력하지 않은 경우, 시스템은 명확한 오류 메시지를 표시하고 누락된 필드를 강조합니다.

- **예산 초과 불가능**: 입력된 예산으로 최소한의 여행 구성(숙박+교통)이 불가능한 경우, 시스템은 "예산이 부족합니다. 최소 XX만원이 필요합니다"와 같은 메시지를 표시합니다.

- **목적지 데이터 부족**: 잘 알려지지 않은 목적지나 데이터가 부족한 지역의 경우, 시스템은 "해당 지역에 대한 정보가 제한적입니다. 일정이 불완전할 수 있습니다"라는 경고를 표시합니다.

- **동시 사용자 처리**: 여러 사용자가 동시에 AI 일정 생성을 요청할 경우, 각 요청은 독립적으로 처리되며 대기 시간이 1분을 초과하지 않습니다.

- **외부 API 장애**: 항공편/숙박 검색 API가 응답하지 않을 경우, 시스템은 기본 추천 일정을 생성하되 "예약 링크를 일시적으로 사용할 수 없습니다"라는 메시지를 표시합니다.

- **지도 서비스 호환성**: 사용자의 디바이스에 카카오맵이나 구글맵이 설치되지 않은 경우, 웹 버전으로 자동 전환하여 경로를 표시합니다.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 사용자로부터 목적지, 여행 기간(날짜), 예산, 동행자 유형(연인/가족/혼자/친구), 선호사항(맛집/관광지/휴양/문화)을 입력받아야 합니다.

- **FR-002**: 시스템은 입력받은 조건을 기반으로 30초 이내에 완전한 여행 일정을 생성해야 합니다.

- **FR-003**: 생성된 여행 일정은 날짜별, 시간대별로 구성되어야 하며, 각 일정에는 숙소, 관광지, 식당, 이동 수단 정보가 포함되어야 합니다.

- **FR-004**: 시스템은 사용자가 입력한 예산 범위 내에서 여행 일정을 구성해야 하며, 예상 총 비용을 명확히 표시해야 합니다.

- **FR-005**: 시스템은 동행자 유형에 따라 적합한 장소를 추천해야 합니다(예: 가족 여행 시 어린이 친화적인 장소, 커플 여행 시 로맨틱한 장소).

- **FR-006**: 시스템은 사용자 선호사항(맛집, 관광지 등)을 우선적으로 반영하여 일정을 구성해야 합니다.

- **FR-007**: 시스템은 생성된 일정의 모든 장소를 지도 위에 시각화하고, 장소 간 이동 경로와 예상 소요 시간을 표시해야 합니다.

- **FR-008**: 시스템은 사용자가 지도 상의 특정 장소를 선택했을 때, 해당 장소의 상세 정보(명칭, 주소, 방문 예정 시간, 추천 이유)를 제공해야 합니다.

- **FR-009**: 시스템은 사용자가 생성된 경로를 카카오맵 또는 구글맵으로 내보낼 수 있는 기능을 제공해야 합니다.

- **FR-010**: 시스템은 여행 일정을 PDF 문서로 생성하여 다운로드할 수 있어야 하며, PDF 생성 시간은 10초를 초과하지 않아야 합니다.

- **FR-011**: PDF 문서는 날짜별 일정, 장소 정보, 지도 이미지, 예산 요약, TravelTailor 브랜딩을 포함해야 합니다.

- **FR-012**: 시스템은 여행 목적지와 날짜에 맞는 항공편 옵션(최소 2-3개)과 예약 링크를 제공해야 합니다.

- **FR-013**: 시스템은 여행 일정에 적합한 숙박 시설(최소 2-3개)과 예약 링크를 제공해야 합니다.

- **FR-014**: 사용자는 계정을 생성하고 로그인할 수 있어야 합니다.

- **FR-015**: 시스템은 로그인한 사용자의 과거 여행 일정과 선호도를 저장해야 합니다.

- **FR-016**: 시스템은 사용자가 새로운 여행 일정을 생성할 때, 과거 선호도를 자동으로 입력 필드에 반영해야 합니다.

- **FR-017**: 시스템은 사용자가 과거 여행 히스토리를 조회하고, 이전 일정을 다시 확인하거나 PDF를 재다운로드할 수 있어야 합니다.

- **FR-018**: 시스템은 필수 입력 필드(목적지, 날짜)가 누락된 경우 명확한 오류 메시지를 표시하고 해당 필드를 강조해야 합니다.

- **FR-019**: 시스템은 예산이 최소 여행 구성 비용보다 낮은 경우, 필요한 최소 예산을 안내해야 합니다.

- **FR-020**: 시스템은 데이터가 부족한 목적지에 대해 경고 메시지를 표시하고, 가능한 범위 내에서 일정을 생성해야 합니다.
- **FR-021**: AI 일정 생성이 시간 초과(30초)되거나 OpenAI API 호출이 실패한 경우, 규칙 기반 템플릿 일정을 생성해 사용자가 즉시 확인할 수 있도록 해야 합니다.
- **FR-022**: Google Places, 항공/숙박 추천 API 호출이 정의된 레이트 리밋을 초과하거나 오류를 반환할 때, 사용자에게 지연/재시도 메시지를 제공하고 부분 데이터라도 반환해야 합니다.

### Key Entities

- **User**: 여행 일정을 생성하는 사용자. 계정 정보, 과거 여행 기록, 선호도 데이터를 포함합니다.

- **Travel Plan**: 생성된 여행 일정. 목적지, 기간, 예산, 동행자 유형, 선호사항, 생성 날짜, 사용자 ID와 연결됩니다.

- **Daily Itinerary**: 특정 날짜의 여행 일정. Travel Plan에 속하며, 날짜, 순서, 방문 장소 목록을 포함합니다.

- **Place**: 여행 중 방문할 장소. 명칭, 주소, 위도/경도, 카테고리(숙소/관광지/식당/카페), 추천 이유, 예상 체류 시간, 예상 비용을 포함합니다.

- **Route**: 두 장소 간의 이동 정보. 출발지, 도착지, 이동 수단, 예상 소요 시간, 예상 거리를 포함합니다.

- **Flight Option**: 추천 항공편 정보. 항공사, 출발/도착 시간, 가격, 예약 링크를 포함합니다.

- **Accommodation Option**: 추천 숙박 시설 정보. 숙소명, 주소, 가격, 평점, 예약 링크를 포함합니다.

- **User Preference**: 사용자의 여행 선호도. 선호하는 예산 범위, 동행자 유형, 관심사(맛집/관광/휴양 등)를 포함합니다.

## Technical Constraints & External Dependencies

- **프론트엔드 기술 스택**: Next.js 14, React 18 LTS, TypeScript 5.x, Tailwind CSS. 차기 메이저 버전은 안정화 이후 별도 스파이크에서 검토한다.
- **백엔드 기술 스택**: FastAPI, Python 3.11, SQLAlchemy, Pydantic v2, LangChain(OpenAI GPT-4o). AI 호출은 비동기 태스크 큐와 Redis 캐시로 관리한다.
- **외부 서비스 계약**:
  - OpenAI API: 일일 비용 상한과 요청 타임아웃(최대 45초)을 설정하고, 실패 시 `fallback-template` 전략을 적용한다.
  - Google Places API: 장소 및 경로 데이터용. 쿼터/요금제 검토 후 호출 수를 예측하고, 캐싱 정책을 문서화한다.
  - 항공편/숙박 검색 API: Skyscanner, Booking.com 등과 제휴 계약 및 지역 규제(한국/일본/EU) 준수 여부가 확인되어야 한다. 계약 완료 전에는 Mock 서비스로 대체한다.
  - Mapbox Directions/Static API: 지도/경로 시각화. 토큰 순환 및 타일 캐시 전략을 적용한다.
- **보안/규제**: GDPR/국내 개인정보보호법을 준수하며, Supabase Auth/S3 호환 스토리지에 대한 데이터 암호화와 삭제 워크플로를 정의한다.
- **운영 제약**: AI 비용은 일일 $50, 월 $1,200 한도를 초과하지 않도록 모니터링하고, 초과 시 자동으로 폴백 모드를 활성화한다.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자는 여행 조건 입력부터 완전한 일정 생성까지 3분 이내에 완료할 수 있습니다.

- **SC-002**: AI가 생성한 여행 일정의 총 예상 비용은 사용자가 입력한 예산의 ±10% 범위 내에 있습니다.

- **SC-003**: 생성된 여행 일정은 각 날짜마다 최소 2-3개의 관광지와 3회의 식사 장소를 포함합니다.

- **SC-004**: 지도 시각화는 모든 장소와 경로를 3초 이내에 렌더링합니다.

- **SC-005**: PDF 생성 및 다운로드는 10초 이내에 완료됩니다.

- **SC-006**: 사용자의 90%가 첫 번째 시도에서 성공적으로 여행 일정을 생성할 수 있습니다.

- **SC-007**: 시스템은 동시에 100명의 사용자 요청을 처리할 수 있으며, 각 요청의 응답 시간이 1분을 초과하지 않습니다.

- **SC-008**: 반복 사용자(2회 이상 일정 생성)의 80%가 자동 반영된 과거 선호도를 활용하여 입력 시간을 50% 단축합니다.

- **SC-009**: 외부 지도 서비스(카카오맵/구글맵) 내보내기 기능의 성공률이 95% 이상입니다.

- **SC-010**: 생성된 여행 일정에 대한 사용자 만족도가 5점 만점에 4점 이상입니다.
